<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quiz - LearnWithPiloton</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0;
    background: #f4f9fc;
    color: #333;
  }
  header {
    background-color: #004aad;
    color: white;
    padding: 15px 20px;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
  }
  header img {
    height: 50px;
    margin-right: 15px;
  }
  nav.main-nav ul {
    list-style: none;
    margin: 0; padding: 0;
    display: flex;
    gap: 20px;
  }
  nav.main-nav a {
    color: white;
    text-decoration: none;
    font-weight: 600;
    font-size: 15px;
  }
  nav.main-nav a:hover {
    text-decoration: underline;
  }
  main {
    max-width: 900px;
    margin: 30px auto;
    background: white;
    padding: 30px 20px;
    border-radius: 10px;
    box-shadow: 0 3px 15px rgba(0,0,0,0.1);
  }
  h1 {
    text-align: center;
    color: #004aad;
    margin-bottom: 20px;
  }
  form {
    margin-top: 20px;
  }
  .question-block {
    margin-bottom: 25px;
  }
  .question-block h3 {
    margin-bottom: 8px;
  }
  .options label {
    display: block;
    margin-bottom: 6px;
    cursor: pointer;
  }
  button {
    background: #004aad;
    border: none;
    color: white;
    padding: 12px 25px;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background: #003080;
  }
  #result {
    margin-top: 30px;
    font-size: 18px;
    font-weight: 600;
    color: #004aad;
    text-align: center;
  }
  footer {
    margin-top: 40px;
    padding: 15px;
    text-align: center;
    background-color: #e6e6e6;
    font-size: 14px;
    color: #555;
  }
</style>
</head>
<body>

<header>
  <img src="logo.png" alt="LearnWithPiloton Logo" />
  <nav class="main-nav" aria-label="Primary">
    <ul>
      <li><a href="index.html#home">Home</a></li>
      <li><a href="index.html#courses">Courses</a></li>
      <li><a href="index.html#youtube">Video Lessons</a></li>
      <li><a href="reward.html">Rewards</a></li>
      <li><a href="quiz.html">Quiz</a></li>
      <li><a href="login.html">Admin</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>
</header>

<main>
  <h1>Take the Quiz</h1>

  <form id="quizForm">
    <label for="userName">Your Name:</label>
    <input type="text" id="userName" placeholder="Enter your name" required style="width:100%;padding:8px;margin-bottom:20px;border-radius:6px;border:1px solid #ccc;" />

    <div id="questionsContainer">
      <!-- Questions will be inserted here -->
    </div>

    <button type="submit">Submit Quiz</button>
  </form>

  <div id="result"></div>
</main>

<footer>
<marquee>  <p>¬© 2025 isa Piloton | Contact: iukunzwenimana@gmail.com</p></marquee>
</footer>

<script>
  // Utility to shuffle array elements
  function shuffleArray(array) {
    for(let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  const quizForm = document.getElementById('quizForm');
  const questionsContainer = document.getElementById('questionsContainer');
  const resultDiv = document.getElementById('result');

  // Load questions from localStorage
  let questions = JSON.parse(localStorage.getItem('quizQuestions')) || [];

  if(questions.length === 0) {
    questionsContainer.innerHTML = "<p>No quiz questions available. Please ask the admin to add some.</p>";
  } else {
    questions.forEach((q, index) => {
      // Prepare shuffled options: 1 correct + wrong answers
      let options = [q.correctAnswer, ...q.wrongAnswers];
      shuffleArray(options);

      // Create question block
      const qBlock = document.createElement('div');
      qBlock.className = 'question-block';
      qBlock.innerHTML = `
        <h3>Q${index + 1} (${q.quizType}): ${q.questionText}</h3>
        <div class="options">
          ${options.map((opt, i) => `
            <label>
              <input type="radio" name="q${index}" value="${opt}" required />
              ${opt}
            </label>
          `).join('')}
        </div>
      `;
      questionsContainer.appendChild(qBlock);
    });
  }

  quizForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const userName = document.getElementById('userName').value.trim();
    if(!userName) {
      alert("Please enter your name.");
      return;
    }
    if(questions.length === 0) {
      alert("No quiz questions available.");
      return;
    }

    // Calculate score per quiz type
    let totalQuestions = questions.length;
    let correctCount = 0;

    // For rank badges: simple scoring system
    // Score as percentage
    questions.forEach((q, i) => {
      const selected = this['q' + i].value;
      if(selected === q.correctAnswer) {
        correctCount++;
      }
    });

    const scorePercent = Math.round((correctCount / totalQuestions) * 100);

    // Determine badge
    function getBadge(score) {
      if(score >= 90) return 'ü•á Gold';
      if(score >= 70) return 'ü•à Silver';
      if(score >= 50) return 'ü•â Bronze';
      return 'üéñÔ∏è Participant';
    }

    const badge = getBadge(scorePercent);

    // Save result to localStorage leaderboard for reward.html
    // We'll save {name, quiz:'Mixed', score, badge, timestamp}
    let leaderboard = JSON.parse(localStorage.getItem('quizScores')) || [];

    leaderboard.push({
      name: userName,
      quiz: 'Mixed',
      score: scorePercent,
      badge: badge,
      timestamp: Date.now()
    });

    // Sort leaderboard descending by score
    leaderboard.sort((a,b) => b.score - a.score);

    localStorage.setItem('quizScores', JSON.stringify(leaderboard));

    resultDiv.textContent = `Hi ${userName}, you scored ${scorePercent}%. Badge earned: ${badge}`;

    // Optionally redirect to rewards page after delay
    setTimeout(() => {
      window.location.href = 'reward.html';
    }, 3500);

    // Send notification to WhatsApp and Email (opens in new tabs)
    function sendNotifications(entry) {
      const phone = '250794924954';
      const email = 'iukunzwenimana@gmail.com';

      const waMsg = `üèÜ Top Quiz Scorer:\nName: ${entry.name}\nQuiz: ${entry.quiz}\nScore: ${entry.score}%\nBadge: ${entry.badge}`;
      const waUrl = `https://wa.me/${phone}?text=${encodeURIComponent(waMsg)}`;

      const mailtoSubject = encodeURIComponent('Top Quiz Scorer Notification');
      const mailtoBody = encodeURIComponent(`Hello,\n\nThe top scorer in the quiz leaderboard is:\n\nName: ${entry.name}\nQuiz: ${entry.quiz}\nScore: ${entry.score}%\nBadge: ${entry.badge}\n\nCongratulations!\n\n-- LearnWithPiloton`);
      const mailtoUrl = `mailto:${email}?subject=${mailtoSubject}&body=${mailtoBody}`;

      // Open WhatsApp and mailto links in new tabs
      window.open(waUrl, '_blank');
      window.open(mailtoUrl, '_blank');
    }

    sendNotifications(leaderboard[0]);
  });
</script>

</body>
</html>
